<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Queryjs by littleserg</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Queryjs</h1>
        <h2>Javascript library to work with sql database based on query-dsl approach</h2>
        <a href="https://github.com/littleserg/queryjs" class="button"><small>View project on</small> GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>
<a id="queryjs" class="anchor" href="#queryjs" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>queryjs</h1>

<p>Javascript promise-based library to work with relational database following query-dsl approach</p>

<h1>
<a id="why" class="anchor" href="#why" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Why?</h1>

<ul>
<li>Safe query-like syntax</li>
<li>Easy-to-use promise based API</li>
<li>Automatic entities mapping with one-to-one and many-to-many support</li>
<li>Multiple database support (sqlite, websql)</li>
<li>debuggable sql queries (pretty-printed sql queries with timing in milliseconds)</li>
</ul>

<h2>
<a id="install" class="anchor" href="#install" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Install</h2>

<p>Install as a bower dependency</p>

<pre><code>bower install sql-queryjs
</code></pre>

<p>Add to your index.html</p>

<div class="highlight highlight-text-html-basic"><pre>&lt;<span class="pl-ent">script</span> <span class="pl-e">src</span>=<span class="pl-s"><span class="pl-pds">"</span>bower_components/queryjs/dist/js/queryjs.min.js<span class="pl-pds">"</span></span>&gt;&lt;/<span class="pl-ent">script</span>&gt;</pre></div>

<h2>
<a id="configuration" class="anchor" href="#configuration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Configuration</h2>

<p>Current implementation designed and supports following databases:</p>

<ul>
<li>sqlite</li>
<li>websql (as a fallback of sqlite)</li>
</ul>

<div class="highlight highlight-source-js"><pre>  <span class="pl-c">// qjs.store.cordovasql.config(dbname, dbversion, description, size, backgroundProcessing, iOSLocation);</span>
  <span class="pl-smi">queryjs</span>.<span class="pl-smi">store</span>.<span class="pl-smi">cordovasql</span>.<span class="pl-en">config</span>(<span class="pl-s"><span class="pl-pds">'</span>track<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>0.0.1<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>VesterTrack Database<span class="pl-pds">'</span></span>, <span class="pl-c1">5</span> <span class="pl-k">*</span> <span class="pl-c1">1024</span> <span class="pl-k">*</span> <span class="pl-c1">1024</span>, <span class="pl-c1">0</span>, <span class="pl-c1">2</span>);</pre></div>

<h2>
<a id="angularjs-integration" class="anchor" href="#angularjs-integration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Angularjs Integration</h2>

<p>Enable angular integration by adding queryjs.angular.js:</p>

<div class="highlight highlight-text-html-basic"><pre>&lt;<span class="pl-ent">script</span> <span class="pl-e">src</span>=<span class="pl-s"><span class="pl-pds">"</span>bower_components/queryjs/dist/js/queryjs.min.js<span class="pl-pds">"</span></span>&gt;&lt;/<span class="pl-ent">script</span>&gt;
&lt;<span class="pl-ent">script</span> <span class="pl-e">src</span>=<span class="pl-s"><span class="pl-pds">"</span>bower_components/queryjs/dist/js/queryjs.angular.js<span class="pl-pds">"</span></span>&gt;&lt;/<span class="pl-ent">script</span>&gt;</pre></div>

<p>or replace queryjs.min.js with the bundle:</p>

<div class="highlight highlight-text-html-basic"><pre>&lt;<span class="pl-ent">script</span> <span class="pl-e">src</span>=<span class="pl-s"><span class="pl-pds">"</span>bower_components/queryjs/dist/js/queryjs.bundle.min.js<span class="pl-pds">"</span></span>&gt;&lt;/<span class="pl-ent">script</span>&gt;</pre></div>

<p>Include angular module</p>

<div class="highlight highlight-source-js"><pre>  <span class="pl-smi">angular</span>.<span class="pl-en">module</span>(<span class="pl-s"><span class="pl-pds">'</span>app<span class="pl-pds">'</span></span>, [<span class="pl-s"><span class="pl-pds">'</span>queryjs<span class="pl-pds">'</span></span>]);</pre></div>

<h2>
<a id="defining-entities" class="anchor" href="#defining-entities" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Defining entities</h2>

<div class="highlight highlight-source-js"><pre>  <span class="pl-k">var</span> Types <span class="pl-k">=</span> <span class="pl-smi">queryjs</span>.<span class="pl-smi">SqlTypes</span>;
  <span class="pl-k">var</span> Order <span class="pl-k">=</span> <span class="pl-smi">queryjs</span>.<span class="pl-en">define</span>(<span class="pl-s"><span class="pl-pds">'</span>order<span class="pl-pds">'</span></span>, {
            id<span class="pl-k">:</span> <span class="pl-smi">Types</span>.<span class="pl-c1">TEXT</span>,
            creationDate<span class="pl-k">:</span> <span class="pl-smi">Types</span>.<span class="pl-c1">DATE</span>,
            processed<span class="pl-k">:</span> <span class="pl-smi">Types</span>.<span class="pl-c1">BOOL</span>,
            authorId<span class="pl-k">:</span> <span class="pl-smi">Types</span>.<span class="pl-c1">TEXT</span>,
            metadata<span class="pl-k">:</span> <span class="pl-smi">Types</span>.<span class="pl-c1">JSON</span>
        });</pre></div>

<h2>
<a id="select-query" class="anchor" href="#select-query" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Select query</h2>

<div class="highlight highlight-source-js"><pre>  <span class="pl-smi">queryjs</span>.<span class="pl-en">from</span>(Order)
      .<span class="pl-en">where</span>(<span class="pl-smi">Order</span>.<span class="pl-smi">processed</span>.<span class="pl-en">eq</span>(<span class="pl-c1">true</span>))
      .<span class="pl-en">list</span>()
      .<span class="pl-en">then</span>(<span class="pl-k">function</span> (<span class="pl-smi">orders</span>) {
        <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Found<span class="pl-pds">'</span></span>, <span class="pl-smi">orders</span>.<span class="pl-c1">length</span>, <span class="pl-s"><span class="pl-pds">'</span>processed orders in the database<span class="pl-pds">'</span></span>)
      })</pre></div>

<h2>
<a id="relationships" class="anchor" href="#relationships" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Relationships</h2>

<p>Current version of the queryjs supports 2 types of relationships
-one to one (many to one)
-one to many</p>

<h4>
<a id="one-to-one" class="anchor" href="#one-to-one" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>One to One</h4>

<div class="highlight highlight-source-js"><pre> <span class="pl-k">var</span> User <span class="pl-k">=</span> <span class="pl-smi">queryjs</span>.<span class="pl-en">define</span>(<span class="pl-s"><span class="pl-pds">'</span>user<span class="pl-pds">'</span></span>, {
            id<span class="pl-k">:</span> <span class="pl-smi">Types</span>.<span class="pl-c1">TEXT</span>,
            email<span class="pl-k">:</span> <span class="pl-smi">Types</span>.<span class="pl-c1">TEXT</span>
        });

  <span class="pl-smi">Order</span>.<span class="pl-en">hasOne</span>(Order, <span class="pl-s"><span class="pl-pds">'</span>author<span class="pl-pds">'</span></span>);

  <span class="pl-smi">queryjs</span>.<span class="pl-en">from</span>(Order)
      .<span class="pl-c1">join</span>(Author).<span class="pl-en">on</span>(<span class="pl-smi">Order</span>.<span class="pl-smi">authorId</span>.<span class="pl-en">eq</span>(<span class="pl-smi">Author</span>.<span class="pl-c1">id</span>))
      .<span class="pl-en">first</span>()
      .<span class="pl-en">then</span>(<span class="pl-k">function</span> <span class="pl-en">onSccuess</span>(<span class="pl-smi">order</span>) {
        <span class="pl-en">console</span>.<span class="pl-c1">log</span>(order);
      });
</pre></div>

<p>Example of produced output:</p>

<div class="highlight highlight-source-json"><pre>  {
    <span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>order1<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>authorId<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>user1<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>author<span class="pl-pds">"</span></span>: {
      <span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>user1<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>email<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>john@johnson.com<span class="pl-pds">"</span></span>
    }
  }</pre></div>

<h4>
<a id="one-to-many" class="anchor" href="#one-to-many" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>One to Many</h4>

<div class="highlight highlight-source-js"><pre> <span class="pl-k">var</span> OrderItem <span class="pl-k">=</span> <span class="pl-smi">queryjs</span>.<span class="pl-en">define</span>(<span class="pl-s"><span class="pl-pds">'</span>order_item<span class="pl-pds">'</span></span>, {
            id<span class="pl-k">:</span> <span class="pl-smi">Types</span>.<span class="pl-c1">TEXT</span>,
            name<span class="pl-k">:</span> <span class="pl-smi">Types</span>.<span class="pl-c1">TEXT</span>,
            price<span class="pl-k">:</span> <span class="pl-smi">Types</span>.<span class="pl-c1">INT</span>,
            oderId<span class="pl-k">:</span> <span class="pl-smi">Type</span>.<span class="pl-c1">TEXT</span>
        });

  <span class="pl-smi">Order</span>.<span class="pl-en">hasMany</span>(OrderItem, <span class="pl-s"><span class="pl-pds">'</span>items<span class="pl-pds">'</span></span>);

  <span class="pl-smi">queryjs</span>.<span class="pl-en">from</span>(Order)
      .<span class="pl-en">leftJoin</span>(OrderItem).<span class="pl-en">on</span>(<span class="pl-smi">Order</span>.<span class="pl-c1">id</span>.<span class="pl-en">eq</span>(<span class="pl-smi">OrderItem</span>.<span class="pl-smi">orderId</span>))
      .<span class="pl-en">first</span>()
      .<span class="pl-en">then</span>(<span class="pl-k">function</span> <span class="pl-en">onSccuess</span>(<span class="pl-smi">order</span>) {
        <span class="pl-en">console</span>.<span class="pl-c1">log</span>(order);
      });
</pre></div>

<p>Example of produced output:</p>

<div class="highlight highlight-source-json"><pre>  {
    <span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>order1<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>processed<span class="pl-pds">"</span></span>: <span class="pl-c1">true</span>,
    <span class="pl-s"><span class="pl-pds">"</span>items<span class="pl-pds">"</span></span>: [
      {
        <span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>1<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>orderId<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>order1<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Item 1<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>price<span class="pl-pds">"</span></span>: <span class="pl-c1">111.2</span>
      },
      {
        <span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>2<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>orderId<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>order1<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Item 2<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>price<span class="pl-pds">"</span></span>: <span class="pl-c1">311.2</span>
      }
    ]
  }</pre></div>

<h2>
<a id="insert-query" class="anchor" href="#insert-query" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Insert query</h2>

<div class="highlight highlight-source-js"><pre>  <span class="pl-k">var</span> newOrder <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Order</span>({
    id<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>1<span class="pl-pds">'</span></span>,
    creationDate<span class="pl-k">:</span> <span class="pl-k">new</span> <span class="pl-en">Date</span>(),
    processed<span class="pl-k">:</span> <span class="pl-c1">false</span>,
    metadata<span class="pl-k">:</span> { itemsNumber<span class="pl-k">:</span> <span class="pl-c1">1</span> }
  });

  <span class="pl-smi">queryjs</span>.<span class="pl-en">insertInto</span>(Order)
      .<span class="pl-en">values</span>(newOrder)
      .<span class="pl-en">execute</span>()
      .<span class="pl-en">then</span>(<span class="pl-k">function</span> () {
        <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Entity has been successfully inserted:<span class="pl-pds">'</span></span>, newOrder);
      });</pre></div>

<h2>
<a id="update-query" class="anchor" href="#update-query" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Update query</h2>

<div class="highlight highlight-source-js"><pre>  <span class="pl-smi">queryjs</span>.<span class="pl-en">update</span>(Order)
        .<span class="pl-en">set</span>(<span class="pl-smi">Order</span>.<span class="pl-smi">processed</span>, <span class="pl-c1">true</span>)
        .<span class="pl-en">where</span>(<span class="pl-smi">Order</span>.<span class="pl-c1">id</span>.<span class="pl-en">eq</span>(<span class="pl-s"><span class="pl-pds">'</span>1<span class="pl-pds">'</span></span>))
        .<span class="pl-en">execute</span>()
        .<span class="pl-en">then</span>(<span class="pl-k">function</span> () {
          <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Update-query has been successfully executed<span class="pl-pds">'</span></span>);
        });</pre></div>

<h2>
<a id="delete-query" class="anchor" href="#delete-query" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Delete query</h2>

<div class="highlight highlight-source-js"><pre>  queryjs
      .<span class="pl-en">delete</span>(Order)
      .<span class="pl-en">where</span>(<span class="pl-smi">Order</span>.<span class="pl-c1">id</span>.<span class="pl-en">eq</span>(<span class="pl-s"><span class="pl-pds">'</span>1<span class="pl-pds">'</span></span>))
      .<span class="pl-en">execute</span>()
      .<span class="pl-en">then</span>(<span class="pl-k">function</span> () {
        <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Entity "1" has been deleted<span class="pl-pds">'</span></span>);
      });</pre></div>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/littleserg/queryjs/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/littleserg/queryjs/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/littleserg/queryjs"></a> is maintained by <a href="https://github.com/littleserg">littleserg</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>
